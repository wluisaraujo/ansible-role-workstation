---
- hosts: all
  become: yes
  gather_facts: False

  tasks:

  - lineinfile:
      path: /etc/fstab
      regexp: '^{{ item }}'
      state: absent
    loop:
      - tmpfs
    register: result

  - lineinfile:
      path: /etc/fstab
      state: present
      line: "tmpfs /dev/shm tmpfs defaults,nodev,noexec,nosuid 0 0"
    when: result is success
